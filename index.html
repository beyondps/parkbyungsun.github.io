<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <link rel="stylesheet" href="./stylesheets/test.css">
    <title>화면정의 서비스 프로토타입</title>
  </head>
  <body>

    <h3>화면정의 서비스 프로토타입</h3>

    <!--
    <img id="preview" src="" width="700" alt="로컬에 있는 이미지가 보여지는 영역">
    <a id="download" download="thumbnail.jpg" target="_blank">
        <img id="thumbnail" src="" width="100" alt="썸네일영역 (클릭하면 다운로드 가능)">
    </a>
    <input type="file" id="getfile" accept="image/*">

    <canvas id="c"></canvas>
-->



    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.7.22/fabric.min.js" crossorigin="anonymous"></script>
    <script>
    
        var file = document.querySelector('#getfile');

        file.onchange = function () {
            var fileList = file.files ;
            
            // 읽기
            var reader = new FileReader();
            reader.readAsDataURL(fileList [0]);

            //로드 한 후
            reader.onload = function  () {
                //로컬 이미지를 보여주기
                document.querySelector('#preview').src = reader.result;
                
                //썸네일 이미지 생성
                var tempImage = new Image(); //drawImage 메서드에 넣기 위해 이미지 객체화
                tempImage.src = reader.result; //data-uri를 이미지 객체에 주입
                tempImage.onload = function() {
                    //리사이즈를 위해 캔버스 객체 생성
                    var canvas = document.createElement('canvas');
                    var canvasContext = canvas.getContext("2d");
                    
                    //캔버스 크기 설정
                    canvas.width = 100; //가로 100px
                    canvas.height = 100; //세로 100px
                    
                    //이미지를 캔버스에 그리기
                    canvasContext.drawImage(this, 0, 0, 100, 100);
                    //캔버스에 그린 이미지를 다시 data-uri 형태로 변환
                    var dataURI = canvas.toDataURL("image/jpeg");
                    
                    //썸네일 이미지 보여주기
                    document.querySelector('#thumbnail').src = dataURI;
                    
                    //썸네일 이미지를 다운로드할 수 있도록 링크 설정
                    document.querySelector('#download').href = dataURI;
                };
            }; 
        }; 
    

        (function() {
        var canvas = this.__canvas = new fabric.Canvas('c');
        fabric.Object.prototype.transparentCorners = false;

        var rect1 = new fabric.Rect({
            width: 200, height: 100, left: 0, top: 50, angle: 30,
            fill: 'rgba(255,0,0,0.5)'
        });

        var rect2 = new fabric.Rect({
            width: 100, height: 100, left: 350, top: 250, angle: -10,
            fill: 'rgba(0,200,0,0.5)'
        });

        var rect3 = new fabric.Rect({
            width: 50, height: 100, left: 275, top: 350, angle: 45,
            stroke: '#eee', strokeWidth: 10,
            fill: 'rgba(0,0,200,0.5)'
        });

        var circle = new fabric.Circle({
            radius: 50, left: 275, top: 75, fill: '#aac'
        });

        var triangle = new fabric.Triangle({
            width: 100, height: 100, left: 50, top: 300, fill: '#cca'
        });

        canvas.add(rect1, rect2, rect3, circle, triangle);
        canvas.on({
            'object:moving': onChange,
            'object:scaling': onChange,
            'object:rotating': onChange,
        });

        function onChange(options) {
            options.target.setCoords();
            canvas.forEachObject(function(obj) {
            if (obj === options.target) return;
            obj.set('opacity' ,options.target.intersectsWithObject(obj) ? 0.5 : 1);
            });
        }
        })();
    </script>
  </body>
</html>